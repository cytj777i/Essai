-- ================ 加载Rayfield UI库 ================
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- ================ 创建主窗口 ================
local Window = Rayfield:CreateWindow({
   Name = "茗噩脚本中心",
   LoadingTitle = "茗噩脚本中心",
   LoadingSubtitle = "正在加载功能...",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "MingEConfig",
      FileName = "Config"
   },
   Discord = {
      Enabled = false,
      Invite = "noinvitelink",
      RememberJoins = true
   },
   KeySystem = false,
})

-- ================ 初始化变量 ================
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local Lighting = game:GetService("Lighting")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer

-- ESP透视功能变量
local ESPEnabled = false
local ESPConnections = {}
local ESPHighlights = {}
local ESPLabels = {}

-- NPC透视功能变量
local NPCESPEnabled = false
local NPCESPConnections = {}
local NPCESPHighlights = {}
local NPCESPLabels = {}

-- 其他功能变量
local nightVisionEnabled = false
local originalAmbient
local infiniteJumpEnabled = false
local jumpConnection
local noclipEnabled = false
local noclipConnection
local lastWalkSpeed = 16
local lastJumpPower = 50
local lastGravity = 196.2

-- ================ 坐标管理变量 ================
local CoordinateManager = {
    SavedCoordinates = {},
    FilePath = "SavedCoordinates.json"
}

-- ================ 传送功能变量 ================
local Teleport = {
    TargetPlayer = nil,
    PlayerList = {}
}

-- ================ 反挂机功能 ================
local function EnableAntiAFK()
    local vu = game:GetService("VirtualUser")
    game:GetService("Players").LocalPlayer.Idled:connect(function()
        vu:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        wait(1)
        vu:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    end)
    print("反挂机已开启")
end

-- ================ 玩家进入提示功能 ================
local function EnablePlayerJoinNotifier()
    local success, result = pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/boyscp/scriscriptsc/main/bbn.lua"))()
    end)
    if success then
        ShowNotification("玩家进入提示", "玩家进入提示已开启")
    else
        ShowNotification("玩家进入提示", "玩家进入提示加载失败")
    end
end

-- ================ 创建选项卡 ================
local MainTab = Window:CreateTab("主功能", "home")
local VisualTab = Window:CreateTab("视觉功能", "eye")
local MovementTab = Window:CreateTab("移动功能", "move")
local PlayerTab = Window:CreateTab("玩家功能", "users")
local UtilityTab = Window:CreateTab("实用工具", "settings")

-- ================ 通知函数 ================
local function ShowNotification(title, content, duration)
    duration = duration or 3
    Rayfield:Notify({
        Title = title,
        Content = content,
        Duration = duration,
        Image = 4483362458,
    })
end

-- ================ 文件操作函数 ================
local function ReadFile(path)
    local success, result = pcall(function()
        if readfile then
            return readfile(path)
        elseif syn and syn.readfile then
            return syn.readfile(path)
        else
            return nil
        end
    end)
    return success and result or nil
end

local function WriteFile(path, content)
    local success, result = pcall(function()
        if writefile then
            writefile(path, content)
            return true
        elseif syn and syn.writefile then
            syn.writefile(path, content)
            return true
        else
            return false
        end
    end)
    return success and result or false
end

-- ================ 坐标管理功能 ================
local function LoadCoordinates()
    local content = ReadFile(CoordinateManager.FilePath)
    if content then
        local success, data = pcall(function()
            return HttpService:JSONDecode(content)
        end)
        if success and type(data) == "table" then
            CoordinateManager.SavedCoordinates = data
            return true
        end
    end
    return false
end

local function SaveCoordinates()
    local success = pcall(function()
        local json = HttpService:JSONEncode(CoordinateManager.SavedCoordinates)
        return WriteFile(CoordinateManager.FilePath, json)
    end)
    return success
end

-- 文本输入弹窗
local function CreateTextInputPopup(title, placeholder, callback)
    local PopupGui = Instance.new("ScreenGui")
    PopupGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

    local PopupFrame = Instance.new("Frame")
    PopupFrame.Parent = PopupGui
    PopupFrame.Size = UDim2.new(0, 250, 0, 150)
    PopupFrame.Position = UDim2.new(0.5, -125, 0.5, -75)
    PopupFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 35)
    PopupFrame.Active = true
    PopupFrame.Draggable = true

    local PopupCorner = Instance.new("UICorner")
    PopupCorner.Parent = PopupFrame
    PopupCorner.CornerRadius = UDim.new(0, 10)

    local PopupStroke = Instance.new("UIStroke")
    PopupStroke.Parent = PopupFrame
    PopupStroke.Color = Color3.fromRGB(80, 120, 200)
    PopupStroke.Thickness = 2

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Parent = PopupFrame
    TitleLabel.Size = UDim2.new(1, -20, 0, 25)
    TitleLabel.Position = UDim2.new(0, 10, 0, 8)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = title
    TitleLabel.TextColor3 = Color3.fromRGB(220, 220, 255)
    TitleLabel.TextSize = 12
    TitleLabel.Font = Enum.Font.GothamBold

    local InputBox = Instance.new("TextBox")
    InputBox.Parent = PopupFrame
    InputBox.Size = UDim2.new(1, -40, 0, 35)
    InputBox.Position = UDim2.new(0, 20, 0, 40)
    InputBox.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
    InputBox.PlaceholderText = placeholder
    InputBox.Text = ""
    InputBox.TextColor3 = Color3.fromRGB(220, 220, 255)
    InputBox.TextSize = 14
    InputBox.Font = Enum.Font.Gotham
    InputBox.ClearTextOnFocus = false

    local InputCorner = Instance.new("UICorner")
    InputCorner.Parent = InputBox
    InputCorner.CornerRadius = UDim.new(0, 6)

    local InputStroke = Instance.new("UIStroke")
    InputStroke.Parent = InputBox
    InputStroke.Color = Color3.fromRGB(80, 120, 200)
    InputStroke.Thickness = 1

    local ConfirmButton = Instance.new("TextButton")
    ConfirmButton.Parent = PopupFrame
    ConfirmButton.Size = UDim2.new(0, 80, 0, 25)
    ConfirmButton.Position = UDim2.new(0.5, -90, 1, -40)
    ConfirmButton.BackgroundColor3 = Color3.fromRGB(40, 120, 80)
    ConfirmButton.Text = "确认"
    ConfirmButton.TextColor3 = Color3.fromRGB(220, 220, 255)
    ConfirmButton.TextSize = 12
    ConfirmButton.Font = Enum.Font.Gotham

    local ConfirmCorner = Instance.new("UICorner")
    ConfirmCorner.Parent = ConfirmButton
    ConfirmCorner.CornerRadius = UDim.new(0, 5)

    local CancelButton = Instance.new("TextButton")
    CancelButton.Parent = PopupFrame
    CancelButton.Size = UDim2.new(0, 80, 0, 25)
    CancelButton.Position = UDim2.new(0.5, 10, 1, -40)
    CancelButton.BackgroundColor3 = Color3.fromRGB(120, 40, 40)
    CancelButton.Text = "取消"
    CancelButton.TextColor3 = Color3.fromRGB(220, 220, 255)
    CancelButton.TextSize = 12
    CancelButton.Font = Enum.Font.Gotham

    local CancelCorner = Instance.new("UICorner")
    CancelCorner.Parent = CancelButton
    CancelCorner.CornerRadius = UDim.new(0, 5)

    ConfirmButton.MouseButton1Click:Connect(function()
        local inputText = InputBox.Text
        if inputText and inputText ~= "" then
            callback(inputText)
        end
        PopupGui:Destroy()
    end)

    CancelButton.MouseButton1Click:Connect(function()
        PopupGui:Destroy()
    end)

    InputBox.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            local inputText = InputBox.Text
            if inputText and inputText ~= "" then
                callback(inputText)
            end
            PopupGui:Destroy()
        end
    end)
end

-- 坐标选择弹窗
local function ShowCoordinateSelectionPopup(title, actionCallback)
    if #CoordinateManager.SavedCoordinates == 0 then
        ShowNotification("没有保存的坐标")
        return
    end

    local SelectionGui = Instance.new("ScreenGui")
    SelectionGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

    local SelectionFrame = Instance.new("Frame")
    SelectionFrame.Parent = SelectionGui
    SelectionFrame.Size = UDim2.new(0, 280, 0, 350)
    SelectionFrame.Position = UDim2.new(0.5, -140, 0.5, -175)
    SelectionFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 35)
    SelectionFrame.Active = true
    SelectionFrame.Draggable = true

    local SelectionCorner = Instance.new("UICorner")
    SelectionCorner.Parent = SelectionFrame
    SelectionCorner.CornerRadius = UDim.new(0, 10)

    local SelectionStroke = Instance.new("UIStroke")
    SelectionStroke.Parent = SelectionFrame
    SelectionStroke.Color = Color3.fromRGB(80, 120, 200)
    SelectionStroke.Thickness = 2

    local Title = Instance.new("TextLabel")
    Title.Parent = SelectionFrame
    Title.Size = UDim2.new(1, -20, 0, 30)
    Title.Position = UDim2.new(0, 10, 0, 10)
    Title.BackgroundTransparency = 1
    Title.Text = title
    Title.TextColor3 = Color3.fromRGB(220, 220, 255)
    Title.TextSize = 14
    Title.Font = Enum.Font.GothamBold

    local ScrollFrame = Instance.new("ScrollingFrame")
    ScrollFrame.Parent = SelectionFrame
    ScrollFrame.Size = UDim2.new(1, -20, 1, -80)
    ScrollFrame.Position = UDim2.new(0, 10, 0, 50)
    ScrollFrame.BackgroundTransparency = 1
    ScrollFrame.ScrollBarThickness = 4
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, #CoordinateManager.SavedCoordinates * 45)

    local CloseButton = Instance.new("TextButton")
    CloseButton.Parent = SelectionFrame
    CloseButton.Size = UDim2.new(0, 80, 0, 25)
    CloseButton.Position = UDim2.new(0.5, -40, 1, -35)
    CloseButton.BackgroundColor3 = Color3.fromRGB(120, 40, 40)
    CloseButton.Text = "关闭"
    CloseButton.TextColor3 = Color3.fromRGB(220, 220, 255)
    CloseButton.TextSize = 12
    CloseButton.Font = Enum.Font.Gotham

    local CloseCorner = Instance.new("UICorner")
    CloseCorner.Parent = CloseButton
    CloseCorner.CornerRadius = UDim.new(0, 5)

    for i, coord in ipairs(CoordinateManager.SavedCoordinates) do
        local CoordButton = Instance.new("TextButton")
        CoordButton.Size = UDim2.new(1, 0, 0, 40)
        CoordButton.Position = UDim2.new(0, 0, 0, (i-1)*45)
        CoordButton.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
        CoordButton.Text = string.format("%s\nX: %.1f, Y: %.1f, Z: %.1f", 
            coord.name, coord.x, coord.y, coord.z)
        CoordButton.TextColor3 = Color3.fromRGB(220, 220, 255)
        CoordButton.TextSize = 10
        CoordButton.Font = Enum.Font.Gotham
        CoordButton.TextWrapped = true
        CoordButton.Parent = ScrollFrame

        local CoordCorner = Instance.new("UICorner")
        CoordCorner.Parent = CoordButton
        CoordCorner.CornerRadius = UDim.new(0, 6)

        local CoordStroke = Instance.new("UIStroke")
        CoordStroke.Parent = CoordButton
        CoordStroke.Color = Color3.fromRGB(80, 120, 200)
        CoordStroke.Thickness = 1

        CoordButton.MouseButton1Click:Connect(function()
            actionCallback(coord, i)
            SelectionGui:Destroy()
        end)
    end

    CloseButton.MouseButton1Click:Connect(function()
        SelectionGui:Destroy()
    end)
end

-- 坐标管理功能
local function SaveCurrentCoordinate()
    local character = Players.LocalPlayer.Character
    if not character then
        ShowNotification("角色未找到")
        return
    end

    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then
        ShowNotification("未找到HumanoidRootPart")
        return
    end

    CreateTextInputPopup("保存坐标", "输入坐标名称", function(coordinateName)
        local position = humanoidRootPart.Position
        local coordinate = {
            name = coordinateName,
            x = math.round(position.X * 100) / 100,
            y = math.round(position.Y * 100) / 100,
            z = math.round(position.Z * 100) / 100,
            timestamp = os.time()
        }

        table.insert(CoordinateManager.SavedCoordinates, coordinate)
        SaveCoordinates()

        ShowNotification("坐标已保存: " .. coordinateName)
    end)
end

local function TeleportToCoordinate()
    ShowCoordinateSelectionPopup("选择要传送的坐标", function(coord)
        local character = Players.LocalPlayer.Character
        if not character then
            ShowNotification("角色未找到")
            return
        end

        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then
            ShowNotification("未找到HumanoidRootPart")
            return
        end

        humanoidRootPart.CFrame = CFrame.new(coord.x, coord.y, coord.z)
        ShowNotification("已传送到: " .. coord.name)
    end)
end

local function DeleteCoordinate()
    ShowCoordinateSelectionPopup("选择要删除的坐标", function(coord, index)
        table.remove(CoordinateManager.SavedCoordinates, index)
        SaveCoordinates()
        ShowNotification("已删除坐标: " .. coord.name)
    end)
end

-- 初始化坐标管理器
LoadCoordinates()

-- ================ ESP透视功能 ================
local function CreateESP(player)
    if player == Players.LocalPlayer then return end

    local character = player.Character
    if not character then return end

    -- 创建高亮效果
    local highlight = Instance.new("Highlight")
    highlight.Name = "ESP_Highlight"
    highlight.FillColor = Color3.fromRGB(255, 255, 255)
    highlight.FillTransparency = 0.7
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.OutlineTransparency = 0.3
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Parent = character

    ESPHighlights[player] = highlight

    -- 创建名称标签
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "ESP_NameTag"
    billboard.Size = UDim2.new(0, 200, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    local head = character:FindFirstChild("Head")
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    billboard.Adornee = head or humanoidRootPart

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = player.Name
    nameLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
    nameLabel.TextStrokeColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextSize = 14
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.Parent = billboard

    if head or humanoidRootPart then
        billboard.Parent = character
        ESPLabels[player] = billboard
    end
end

local function RemoveESP(player)
    if ESPHighlights[player] then
        ESPHighlights[player]:Destroy()
        ESPHighlights[player] = nil
    end

    if ESPLabels[player] then
        ESPLabels[player]:Destroy()
        ESPLabels[player] = nil
    end
end

local function EnableESP()
    if ESPEnabled then return end
    ESPEnabled = true

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer then
            CreateESP(player)
        end
    end

    ShowNotification("ESP透视已开启")
end

local function DisableESP()
    if not ESPEnabled then return end
    ESPEnabled = false

    for _, player in pairs(Players:GetPlayers()) do
        RemoveESP(player)
    end

    ShowNotification("ESP透视已关闭")
end

-- ================ NPC透视功能 ================
local function CreateNPCESP(npc)
    if not npc:IsA("Model") then return end

    local humanoid = npc:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    -- 检查是否已经是玩家角色
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character == npc then
            return
        end
    end

    local highlight = Instance.new("Highlight")
    highlight.Name = "NPC_ESP_Highlight"
    highlight.FillColor = Color3.fromRGB(255, 255, 255)
    highlight.FillTransparency = 0.7
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.OutlineTransparency = 0.3
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Parent = npc

    NPCESPHighlights[npc] = highlight
end

local function RemoveNPCESP(npc)
    if NPCESPHighlights[npc] then
        NPCESPHighlights[npc]:Destroy()
        NPCESPHighlights[npc] = nil
    end
end

local function ScanForNPCs()
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and obj ~= Players.LocalPlayer.Character then
            local humanoid = obj:FindFirstChildOfClass("Humanoid")
            if humanoid then
                local isPlayer = false
                for _, player in ipairs(Players:GetPlayers()) do
                    if player.Character == obj then
                        isPlayer = true
                        break
                    end
                end

                if not isPlayer then
                    CreateNPCESP(obj)
                end
            end
        end
    end
end

local function EnableNPCESP()
    if NPCESPEnabled then return end
    NPCESPEnabled = true
    ScanForNPCs()
    ShowNotification("NPC透视已开启")
end

local function DisableNPCESP()
    if not NPCESPEnabled then return end
    NPCESPEnabled = false

    for npc, _ in pairs(NPCESPHighlights) do
        RemoveNPCESP(npc)
    end

    ShowNotification("NPC透视已关闭")
end

-- ================ 夜视功能 ================
local function ToggleNightVision(value)
    if value then
        originalAmbient = Lighting.Ambient
        Lighting.Ambient = Color3.new(1, 1, 1)
        nightVisionEnabled = true
        ShowNotification("夜视已开启")
    else
        if originalAmbient then
            Lighting.Ambient = originalAmbient
        else
            Lighting.Ambient = Color3.new(0, 0, 0)
        end
        nightVisionEnabled = false
        ShowNotification("夜视已关闭")
    end
end

-- ================ 无限跳功能 ================
local function ToggleInfiniteJump(value)
    if value then
        infiniteJumpEnabled = true
        jumpConnection = UserInputService.JumpRequest:Connect(function()
            local character = player.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid:ChangeState("Jumping")
                end
            end
        end)
        ShowNotification("无限跳已开启")
    else
        infiniteJumpEnabled = false
        if jumpConnection then
            jumpConnection:Disconnect()
            jumpConnection = nil
        end
        ShowNotification("无限跳已关闭")
    end
end

-- ================ 穿墙功能 ================
local function ToggleNoclip(value)
    if value then
        noclipEnabled = true
        noclipConnection = RunService.Stepped:Connect(function()
            if not noclipEnabled then
                noclipConnection:Disconnect()
                return
            end
            local character = player.Character
            if character then
                for _, part in pairs(character:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
        ShowNotification("穿墙模式已开启")
    else
        noclipEnabled = false
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        local character = player.Character
        if character then
            for _, part in pairs(character:GetChildren()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
        ShowNotification("穿墙模式已关闭")
    end
end

-- ================ 速度设置功能 ================
local function SetWalkSpeed(value)
    local character = player.Character
    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = value
            lastWalkSpeed = value
            return true
        end
    end
    return false
end

-- ================ 跳跃高度设置功能（修复版） ================
local function SetJumpPower(value)
    local character = player.Character
    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.JumpPower = value
            lastJumpPower = value
            return true
        end
    end
    return false
end

-- ================ 重力设置功能 ================
local function SetGravity(value)
    Workspace.Gravity = value
    lastGravity = value
    ShowNotification("重力已设置为: " .. value)
end

-- ================ 传送功能 ================
local function GetAllPlayers()
    local players = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer then
            table.insert(players, player)
        end
    end
    return players
end

local function TeleportToPlayer()
    local players = GetAllPlayers()
    if #players == 0 then
        ShowNotification("没有其他玩家")
        return
    end

    local playerNames = {}
    for _, player in ipairs(players) do
        table.insert(playerNames, player.Name)
    end

    Rayfield:Dropdown({
        Name = "选择要传送的玩家",
        Options = playerNames,
        CurrentOption = "",
        Flag = "PlayerSelection",
        Callback = function(selectedName)
            for _, targetPlayer in ipairs(players) do
                if targetPlayer.Name == selectedName then
                    local myChar = Players.LocalPlayer.Character
                    local targetChar = targetPlayer.Character

                    if not myChar or not targetChar then
                        ShowNotification("角色未找到")
                        return
                    end

                    local myRoot = myChar:FindFirstChild("HumanoidRootPart")
                    local targetRoot = targetChar:FindFirstChild("HumanoidRootPart")

                    if myRoot and targetRoot then
                        local newPos = Vector3.new(
                            targetRoot.Position.X,
                            targetRoot.Position.Y + 5,
                            targetRoot.Position.Z
                        )
                        myRoot.CFrame = CFrame.new(newPos)
                        ShowNotification("已传送到 "..targetPlayer.Name.." 的头上")
                    else
                        ShowNotification("未找到HumanoidRootPart")
                    end
                    break
                end
            end
        end,
    })
end

-- ================ 角色重生事件处理 ================
player.CharacterAdded:Connect(function(character)
    if infiniteJumpEnabled then
        character:WaitForChild("Humanoid")
        if jumpConnection then
            jumpConnection:Disconnect()
        end
        ToggleInfiniteJump(true)
    end

    if noclipEnabled then
        character:WaitForChild("Humanoid")
        ToggleNoclip(true)
    end

    local humanoid = character:WaitForChild("Humanoid")
    humanoid.WalkSpeed = lastWalkSpeed
    humanoid.JumpPower = lastJumpPower
end)

-- ================ 主功能选项卡 ================
MainTab:CreateSection("基本功能")

local FlyToggle = MainTab:CreateToggle({
   Name = "飞行模式",
   CurrentValue = false,
   Flag = "FlyToggle",
   Callback = function(Value)
        if Value then
            local success, result = pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/cytj777i/666-/main/%E5%8F%AA%E8%83%BD%E8%87%AA%E5%B7%B1%E6%90%9E%E4%B8%80%E4%B8%AA%E4%BA%86"))()
            end)
            if success then
                ShowNotification("飞行功能已加载")
            else
                ShowNotification("飞行功能加载失败")
                FlyToggle:Set(false)
            end
        else
            ShowNotification("飞行功能已关闭")
        end
   end,
})

local SpeedSlider = MainTab:CreateSlider({
   Name = "移动速度",
   Range = {16, 200},
   Increment = 1,
   Suffix = "速度",
   CurrentValue = 16,
   Flag = "SpeedSlider",
   Callback = function(Value)
        if SetWalkSpeed(Value) then
            ShowNotification("移动速度已设置为: " .. Value)
        else
            ShowNotification("设置失败，请确保角色存在")
        end
   end,
})

-- ================ 修复跳跃高度滑块 ================
local JumpPowerSlider = MainTab:CreateSlider({
   Name = "跳跃高度",
   Range = {50, 200},
   Increment = 1,
   Suffix = "高度",
   CurrentValue = 50,
   Flag = "JumpPowerSlider",
   Callback = function(Value)
        if SetJumpPower(Value) then
            ShowNotification("跳跃高度已设置为: " .. Value)
        else
            ShowNotification("设置失败，请确保角色存在")
        end
   end,
})

-- ================ 添加重力设置滑块 ================
local GravitySlider = MainTab:CreateSlider({
   Name = "重力设置",
   Range = {0, 200},
   Increment = 1,
   Suffix = "重力",
   CurrentValue = 196,
   Flag = "GravitySlider",
   Callback = function(Value)
        SetGravity(Value)
   end,
})

MainTab:CreateSection("其他功能")

MainTab:CreateButton({
   Name = "传送工具",
   Callback = function()
        local mouse = player:GetMouse() 
        local tool = Instance.new("Tool") 
        tool.RequiresHandle = false 
        tool.Name = "[茗噩]传送工具"
        tool.Activated:connect(function() 
            local pos = mouse.Hit + Vector3.new(0, 2.5, 0) 
            pos = CFrame.new(pos.X, pos.Y, pos.Z) 
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                player.Character.HumanoidRootPart.CFrame = pos 
            end
        end) 
        tool.Parent = player.Backpack
        ShowNotification("传送工具已添加到背包")
   end,
})

-- ================ 视觉功能选项卡 ================
VisualTab:CreateSection("透视功能")

local ESPToggle = VisualTab:CreateToggle({
   Name = "ESP透视",
   CurrentValue = false,
   Flag = "ESPToggle",
   Callback = function(Value)
        if Value then
            EnableESP()
        else
            DisableESP()
        end
   end,
})

local NPCESPToggle = VisualTab:CreateToggle({
   Name = "NPC透视",
   CurrentValue = false,
   Flag = "NPCESPToggle",
   Callback = function(Value)
        if Value then
            EnableNPCESP()
        else
            DisableNPCESP()
        end
   end,
})

VisualTab:CreateSection("视觉效果")

local NightVisionToggle = VisualTab:CreateToggle({
   Name = "夜视",
   CurrentValue = false,
   Flag = "NightVisionToggle",
   Callback = function(Value)
        ToggleNightVision(Value)
   end,
})

-- ================ 移动功能选项卡 ================
MovementTab:CreateSection("移动增强")

local InfiniteJumpToggle = MovementTab:CreateToggle({
   Name = "无限跳",
   CurrentValue = false,
   Flag = "InfiniteJumpToggle",
   Callback = function(Value)
        ToggleInfiniteJump(Value)
   end,
})

local NoclipToggle = MovementTab:CreateToggle({
   Name = "穿墙模式",
   CurrentValue = false,
   Flag = "NoclipToggle",
   Callback = function(Value)
        ToggleNoclip(Value)
   end,
})

MovementTab:CreateSection("特殊移动")

MovementTab:CreateButton({
   Name = "爬墙功能",
   Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://pastebin.com/raw/zXk4Rq2r"))()
        end)
        if success then
            ShowNotification("爬墙功能已加载")
        else
            ShowNotification("爬墙功能加载失败")
        end
   end,
})

MovementTab:CreateButton({
   Name = "踏空行走",
   Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet('https://raw.githubusercontent.com/GhostPlayer352/Test4/main/Float'))()
        end)
        if success then
            ShowNotification("踏空行走已加载")
        else
            ShowNotification("踏空行走加载失败")
        end
   end,
})

-- ================ 玩家功能选项卡 ================
PlayerTab:CreateSection("传送功能")

PlayerTab:CreateButton({
   Name = "传送到玩家",
   Callback = function()
        TeleportToPlayer()
   end,
})

PlayerTab:CreateSection("玩家互动")

PlayerTab:CreateButton({
   Name = "走路创人",
   Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/cytj777i/Throw/main/Throw"))()
        end)
        if success then
            ShowNotification("走路创人功能已加载")
        else
            ShowNotification("走路创人功能加载失败")
        end
   end,
})

PlayerTab:CreateButton({
   Name = "甩飞功能",
   Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/dingding123hhh/hknvh/main/%E7%94%A9%E9%A3%9E.txt"))()
        end)
        if success then
            ShowNotification("甩飞功能已加载")
        else
            ShowNotification("甩飞功能加载失败")
        end
   end,
})

-- ================ 实用工具选项卡 ================
UtilityTab:CreateSection("坐标管理")

UtilityTab:CreateButton({
   Name = "保存当前坐标",
   Callback = function()
        SaveCurrentCoordinate()
   end,
})

UtilityTab:CreateButton({
   Name = "传送保存坐标",
   Callback = function()
        TeleportToCoordinate()
   end,
})

UtilityTab:CreateButton({
   Name = "删除保存坐标",
   Callback = function()
        DeleteCoordinate()
   end,
})

-- ================ 添加玩家进入提示功能 ================
UtilityTab:CreateSection("提示功能")

UtilityTab:CreateButton({
   Name = "玩家进入提示",
   Callback = function()
        EnablePlayerJoinNotifier()
   end,
})

UtilityTab:CreateSection("其他工具")

UtilityTab:CreateButton({
   Name = "防止摔落伤害",
   Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/cytj777i/Fall-injury/main/%E9%98%B2%E6%AD%A2%E6%91%94%E8%90%BD%E4%BC%A4%E5%AE%B3"))()
        end)
        if success then
            ShowNotification("防止摔落伤害已开启")
        else
            ShowNotification("防止摔落伤害加载失败")
        end
   end,
})

UtilityTab:CreateButton({
   Name = "全局物体漂浮",
   Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/cytj777i/6669178/main/%E5%85%A8%E5%B1%80%E7%89%A9%E4%BD%93%E6%BC%82%E6%B5%AE%E6%9C%80%E7%BB%88%E4%BC%98%E5%8C%96%E7%89%88"))()
        end)
        if success then
            ShowNotification("全局物体漂浮已开启")
        else
            ShowNotification("全局物体漂浮加载失败")
        end
   end,
})

UtilityTab:CreateButton({
   Name = "单一物体飞行",
   Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/cytj777i/6669178/main/单一物体飞行载自己最终优化版"))()
        end)
        if success then
            ShowNotification("单一物体飞行已加载")
        else
            ShowNotification("单一物体飞行加载失败")
        end
   end,
})

UtilityTab:CreateButton({
   Name = "零件破坏者",
   Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/cytj777i/-/main/零件破坏者v2"))()
        end)
        if success then
            ShowNotification("零件破坏者已加载")
        else
            ShowNotification("零件破坏者加载失败")
        end
   end,
})

UtilityTab:CreateButton({
   Name = "隐身功能",
   Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet('https://pastebin.com/raw/3Rnd9rHf'))()
        end)
        if success then
            ShowNotification("隐身功能已开启")
        else
            ShowNotification("隐身功能加载失败")
        end
   end,
})

UtilityTab:CreateButton({
   Name = "Egor功能",
   Callback = function()
        local success, result = pcall(function()
            loadstring(game:HttpGet("https://rawscripts.net/raw/Universal-Script-Fake-Lag-Runner-read-description-44701"))()
        end)
        if success then
            ShowNotification("Egor功能已开启")
        else
            ShowNotification("Egor功能加载失败")
        end
   end,
})

-- ================ 显示加载完成消息并开启反挂机 ================
ShowNotification("茗噩脚本中心", "脚本加载完成！反挂机已开启", 5)
print("茗噩脚本中心UI已成功加载！")
print("反挂机开启")

-- 自动开启反挂机功能
EnableAntiAFK()

-- 同时发送Roblox原生通知
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "茗噩脚本中心",
    Text = "茗噩脚本中心加载完成（反挂机已开启）",
    Duration = 5, 
})